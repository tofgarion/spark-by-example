#+EXPORT_FILE_NAME: ../../../non-mutating/Adjacent_Find.org
#+OPTIONS: author:nil title:nil toc:nil

** The Adjacent_Find algorithm

   The ~Adjacent_Find~ algorithm is another finding algorithm. Its
   signature is the following:

   #+BEGIN_SRC ada
     function Adjacent_Find (A : T_Arr) return Option
   #+END_SRC

   Given an array ~A~, ~Adjacent_Find~ will either return:

   - an ~Option~ whose value is a valid index ~I~ of ~A~ such that ~A
     (I) = A (I + 1)~ and ~I~ is the smallest index verifying this
     property
   - an option with ~Result~ equal to ~False~ if no such index exists

*** The predicate Has_Equal_Neighbors

    As usual, we will first define a predicate to help us writing the
    specification. ~Has_Equal_Neigbors (A)~ is true if the array ~A~
    has two consecutive elements that are equal:

    #+INCLUDE: "../../../spec/has_equal_neighbors_p.ads" :src ada :range-begin "function Has_Equal_Neighbors" :range-end "\s-*(\([^()]*?\(?:\n[^()]*\)*?\)*)\s-*\([^;]*?\(?:\n[^;]*\)*?\)*;" :lines "10-15"

    Notice that we must take care of one boundary case, i.e., when ~A~
    is empty, otherwise as ~A'Last~ can be less than ~A'First~ when
    ~A'Length = 0~, it could take ~Integer'First~ as a value and an
    overflow would occur due to ~A'Last - 1~.

*** Specification of Adjacent_Find

    The specification of ~Adjacent_Find~ will use the following
    contract cases:

    - either there are two adjacent elements in ~A~ that are equal and
      in this case, ~Adjacent_Find~ must return an ~Option~ with a
      valid index ~I~ such that ~A (I) = A (I + 1)~ and there is no
      adjacent equal elements in ~A~ up to ~I~
    - or ~Adjacent_Find~ must return an ~Option~ specifying that
      such an index does not exist

    #+INCLUDE: "../../../non-mutating/adjacent_find_p.ads" :src ada :range-begin "function Adjacent_Find" :range-end "\s-*(\([^()]*?\(?:\n[^()]*\)*?\)*)\s-*\([^;]*?\(?:\n[^;]*\)*?\)*;" :lines "9-21"

*** Implementation of Adjacent_Find

    The implementation of ~Adjacent_Find~ goes through ~A~, searching
    for two consecutive elements that are equal is defined as follows:

    #+INCLUDE: "../../../non-mutating/adjacent_find_p.adb" :src ada :range-begin "function Adjacent_Find" :range-end "end Adjacent_Find;" :lines "7-31"

    The invariants needed to prove the function are the following:

    - two consecutive and equal elements have not been found yet in
      ~A~
    - the result specifies that there is no index respecting the
      expected property

# Local Variables:
# ispell-dictionary: "english"
# End:
